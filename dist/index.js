"use strict";var z=Object.create;var g=Object.defineProperty;var V=Object.getOwnPropertyDescriptor;var W=Object.getOwnPropertyNames;var K=Object.getPrototypeOf,J=Object.prototype.hasOwnProperty;var m=(e,t)=>{for(var n in t)g(e,n,{get:t[n],enumerable:!0})},X=(e,t,n,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of W(t))!J.call(e,o)&&o!==n&&g(e,o,{get:()=>t[o],enumerable:!(s=V(t,o))||s.enumerable});return e};var d=(e,t,n)=>(n=e!=null?z(K(e)):{},X(t||!e||!e.__esModule?g(n,"default",{value:e,enumerable:!0}):n,e));var G=require("discord.js");var O=d(require("dotenv"));O.default.config();var{DISCORD_TOKEN:_,DISCORD_CLIENT_ID:T,DISCORD_GUILD_ID:M,EVENTS_CHANNEL_ID:$}=process.env;if(!_||!T||!M||!$)throw new Error("Missing environment variables");var a={DISCORD_TOKEN:_,DISCORD_CLIENT_ID:T,DISCORD_GUILD_ID:M,EVENTS_CHANNEL_ID:$};var j=d(require("node-cron"));var h={};m(h,{data:()=>Y,execute:()=>ee});var b=require("discord.js"),Y=new b.SlashCommandBuilder().setName("ping").setDescription("Replies with Pong!");async function ee(e){return e.reply("Pong!")}var E={};m(E,{data:()=>oe,execute:()=>se});var c=require("discord.js"),H=require("mh-wilds-event-scraper");var q=require("discord.js"),k=e=>e.charAt(0).toUpperCase()+e.slice(1),te=e=>{let t=`${e.difficulty}\u2B50`;return`${e.questName} [${t}]`},B=e=>{let t=e.targetMonster.split(" ").join("_")+"_Icon.png",n={"arch-tempered":"Orange",tempered:"Purple",normal:"Grey"};return{embed:[new q.EmbedBuilder().setColor(n[e.variant]).setTitle(`${k(e.questType)} ${e.amount>1?e.amount:"The"} ${e.variant==="normal"?"":`${k(e.variant)} `}${e.targetMonster}`).setAuthor({name:te(e),iconURL:`attachment://${e.questType}.png`}).setThumbnail(`attachment://${t}`).addFields({name:"\u200B",value:e.description},{name:"\u200B",value:"\u200B"},{name:"Locales",value:e.locales,inline:!0},{name:"Required HR",value:`${e.requiredRank.toString()}+`,inline:!0})]}};var C=d(require("fs")),I=d(require("path")),D={},y={};function ne(){console.log("Preloading icons...");let e="assets/icons/large";C.default.readdirSync(e).forEach(n=>{let s=new c.AttachmentBuilder(I.default.join(e,n));D[n]={file:s,path:`attachment://${n}`}});let t="assets/icons/quest";C.default.readdirSync(t).forEach(n=>{let s=new c.AttachmentBuilder(I.default.join(t,n));y[n]={file:s,path:`attachment://${n}`}})}ne();var oe=new c.SlashCommandBuilder().setName("events").setDescription("Return a list of event scheduled").addStringOption(e=>e.setName("type").setDescription("Select mode").addChoices({name:"Permanent",value:"permanent"},{name:"Limited",value:"limited"}).setRequired(!0));async function se(e){try{let t=await(0,H.parseMHWildsEvents)("https://info.monsterhunter.com/wilds/event-quest/en-us/schedule?utc=7"),n=e.options.getString("type",!0);if(t.limitedEventQuests.length===0&&t.permanentQuests.length===0)return e.editReply("No events found.");let s=n==="permanent"?t.permanentQuests:t.limitedEventQuests[0].eventQuests,o=[],f=[],A=s.map(r=>{let w=r.targetMonster.split(" ").join("_")+"_Icon.png",x=r.questType+".png";return o.includes(D[w])||o.push(D[w]),f.includes(y[x])||f.push(y[x]),B(r)}),P=new Date(t.limitedEventQuests[0].startDate).toLocaleString("th-TH",{timeZone:"Asia/Bangkok"}),U=new Date(t.limitedEventQuests[0].endDate).toLocaleString("th-TH",{timeZone:"Asia/Bangkok"}),Z=A.flatMap(r=>r.embed);return e.reply({content:n==="permanent"?"Permanent Events":`Here are the events during : ${P} - ${U}`,embeds:Z,files:[...o.map(r=>r.file),...f.map(r=>r.file)]})}catch(t){return console.error(t),e.editReply("Failed to fetch events.")}}var R={};m(R,{data:()=>re,execute:()=>ae});var L=require("discord.js"),re=new L.SlashCommandBuilder().setName("meta").setDescription("Return Meta Build Guide Reddit Link");async function ae(e){return e.reply("Here is the link to the Meta Build Guide: https://www.reddit.com/r/MonsterHunterMeta/comments/1jkaxo7/mhwilds_endgame_meta_builds_compilation/")}var v={};m(v,{data:()=>me,execute:()=>ce});var Q=require("discord.js"),ie=["Arkveld","Rey Dau","Nu Udra","Uth Duna","Jin Dahaad","Gore Magala","Mizutsune","Zho Shia"],me=new Q.SlashCommandBuilder().setName("hzv").setDescription("Return Meta Build Guide Reddit Link").addStringOption(e=>e.setName("monster").setDescription("Select monster").addChoices(...ie.map(t=>({name:t,value:t}))).setRequired(!0));async function ce(e){let n=`./assets/hitzone-value/${e.options.getString("monster",!0).split(" ").join("_")}_HZV.png`;return e.reply({files:[n]})}var N={};m(N,{data:()=>de,execute:()=>le});var l=require("discord.js"),S="https://genshin.hoyoverse.com/en/gift?code=";var de=new l.SlashCommandBuilder().setName("gi-code").setDescription("Return a redeem link for Genshin Impact, up to 3 codes").addStringOption(e=>e.setName("c1").setDescription("Enter the code").setRequired(!0)).addStringOption(e=>e.setName("c2").setDescription("Enter the code").setRequired(!1)).addStringOption(e=>e.setName("c3").setDescription("Enter the code").setRequired(!1));async function le(e){console.log("gi-code invoked");let t=e.options.getString("c1",!0),n=e.options.getString("c2",!1),s=e.options.getString("c3",!1);if(console.log("parsing code with",t,n,s),!t)return e.editReply("No code provided.");let o=[];return t&&o.push(`${S}${t}`),n&&o.push(`${S}${n}`),s&&o.push(`${S}${s}`),console.log("returning message",o),e.reply({content:o.join(`
`),flags:l.MessageFlags.SuppressEmbeds})}var i={ping:h,meta:R,events:E,"gi-code":N,hzv:v};var p=require("discord.js");var pe=Object.values(i).map(e=>e.data),ue=new p.REST({version:"10"}).setToken(a.DISCORD_TOKEN);async function F(){try{console.log("Started refreshing application (/) commands."),await ue.put(p.Routes.applicationGuildCommands(a.DISCORD_CLIENT_ID,a.DISCORD_GUILD_ID),{body:pe}),console.log("Successfully reloaded application (/) commands.")}catch(e){console.error(e)}}var u=new G.Client({intents:["Guilds","GuildMessages","DirectMessages"]}),fe="0 10 * * 3";u.once("ready",async()=>{console.log("Discord bot is ready! \u{1F916}"),await F(),j.default.schedule(fe,async()=>{console.log("\u23F0 Running /events limited job...");try{let e=await u.channels.fetch(a.EVENTS_CHANNEL_ID);if(!e)return;let t={options:{getString:n=>n==="type"?"limited":null},reply:n=>e.send(n),editReply:n=>e.send(n)};await i.events.execute(t)}catch(e){console.error("Failed scheduled job:",e)}})});u.on("interactionCreate",async e=>{if(!e.isCommand())return;let{commandName:t}=e;i[t]&&i[t].execute(e)});u.login(a.DISCORD_TOKEN);
