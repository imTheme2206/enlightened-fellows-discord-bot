"use strict";var ne=Object.create;var R=Object.defineProperty;var oe=Object.getOwnPropertyDescriptor;var se=Object.getOwnPropertyNames;var re=Object.getPrototypeOf,ae=Object.prototype.hasOwnProperty;var g=(e,t)=>{for(var n in t)R(e,n,{get:t[n],enumerable:!0})},ie=(e,t,n,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of se(t))!ae.call(e,s)&&s!==n&&R(e,s,{get:()=>t[s],enumerable:!(o=oe(t,s))||o.enumerable});return e};var f=(e,t,n)=>(n=e!=null?ne(re(e)):{},ie(t||!e||!e.__esModule?R(n,"default",{value:e,enumerable:!0}):n,e));var X=require("discord.js");var A=f(require("dotenv"));A.default.config();var{DISCORD_TOKEN:k,DISCORD_CLIENT_ID:U,DISCORD_GUILD_ID:$,EVENTS_CHANNEL_ID:G}=process.env;if(!k||!U||!$||!G)throw new Error("Missing environment variables");var l={DISCORD_TOKEN:k,DISCORD_CLIENT_ID:U,DISCORD_GUILD_ID:$,EVENTS_CHANNEL_ID:G};var Y=f(require("node-cron"));var P={};g(P,{data:()=>ce,execute:()=>me});var q=require("discord.js"),ce=new q.SlashCommandBuilder().setName("ping").setDescription("Replies with Pong!");async function me(e){return e.reply("Pong!")}var x={};g(x,{data:()=>Ie,execute:()=>ye});var h=require("discord.js"),z=require("mh-wilds-event-scraper");var L=require("discord.js"),F=e=>e.charAt(0).toUpperCase()+e.slice(1),de=e=>{let t=`${e.difficulty}\u2B50`;return`${e.questName} [${t}]`},H=e=>{let t=e.targetMonster!=="Unknown"?e.targetMonster.split(" ").join("_")+"_Icon.png":"Unknown_Icon.png",n={"arch-tempered":"Orange",tempered:"Purple",normal:"Grey",frenzied:"Grey"};return{embed:[new L.EmbedBuilder().setColor(n[e.variant]).setTitle(`${F(e.questType)} ${e.amount>1?e.amount:"The"} ${e.variant==="normal"?"":`${F(e.variant)} `}${e.targetMonster}`).setAuthor({name:de(e),iconURL:`attachment://${e.questType}.png`}).setThumbnail(`attachment://${t}`).addFields({name:"\u200B",value:e.description},{name:"\u200B",value:"\u200B"},{name:"Locales",value:e.locales,inline:!0},{name:"Required HR",value:`${e.requiredRank.toString()}+`,inline:!0})]}};var m=require("discord.js"),E={prev:"pagination_prev",next:"pagination_next"},B=300*1e3,le=(e,t)=>{if(t<=0)throw new Error("pageSize must be greater than 0");let n=[];for(let o=0;o<e.length;o+=t)n.push(e.slice(o,o+t));return n},ue=e=>{let t=new Map;return e.forEach(n=>{n.attachments.forEach(o=>{t.has(o.key)||t.set(o.key,o)})}),Array.from(t.values()).map(n=>n.file)},j=(e,t)=>{let n=le(e,t),o=n.map(s=>ue(s));return{pages:n,attachmentsByPage:o}},S=(e,t,n,o=m.ButtonStyle.Primary)=>t<=1?[]:[new m.ActionRowBuilder().addComponents(new m.ButtonBuilder().setCustomId(n.prev).setLabel("Previous").setStyle(o).setDisabled(e===0),new m.ButtonBuilder().setCustomId(n.next).setLabel("Next").setStyle(o).setDisabled(e===t-1))],pe=(e,t)=>e===t.prev||e===t.next,Q=(e,t,n={})=>{let{pages:o,attachmentsByPage:s}=t;if(o.length<=1||typeof e.createMessageComponentCollector!="function")return;let i=n.buttonIds??E,d=n.timeoutMs??B,a=n.initialPage??0,p=o.length,y=n.commandUserId??null,v=n.buildComponents?r=>n.buildComponents(r,p,i):r=>S(r,p,i),c=e.createMessageComponentCollector({componentType:m.ComponentType.Button,time:d});return c.on("collect",async r=>{if(pe(r.customId,i)){if(y&&r.user?.id!==y){await r.reply({content:"Only the command invoker can use these buttons.",ephemeral:!0});return}if(r.customId===i.prev&&a>0)a-=1;else if(r.customId===i.next&&a<p-1)a+=1;else{await r.deferUpdate();return}await r.update({embeds:o[a].map(te=>te.embed),files:s[a],attachments:[],components:v(a)}),n.onPageChange&&await n.onPageChange(a)}}),c.on("end",async()=>{try{await e.edit({components:[]})}catch(r){console.error("Failed to clean up pagination components:",r)}n.onCollectorEnd&&await n.onCollectorEnd(a)}),c};var T=f(require("fs")),w=f(require("path")),C=f(require("dayjs")),V={},W={},ge=5,fe=e=>e.map(t=>{let n=t.targetMonster!=="Unknown"?t.targetMonster.split(" ").join("_")+"_Icon.png":"Unknown_Icon.png",o=`${t.questType}.png`,s=[],i=V[n],d=W[o];i&&s.push(i),d&&s.push(d);let{embed:a}=H(t);return{embed:a[0],attachments:s}}),he=()=>{console.log("Preloading icons...");let e="assets/icons/large";T.default.readdirSync(e).forEach(n=>{let o=new h.AttachmentBuilder(w.default.join(e,n));V[n]={file:o,key:`attachment://${n}`}});let t="assets/icons/quest";T.default.readdirSync(t).forEach(n=>{let o=new h.AttachmentBuilder(w.default.join(t,n));W[n]={file:o,key:`attachment://${n}`}})};he();var Ie=new h.SlashCommandBuilder().setName("events").setDescription("Return a list of event scheduled").addStringOption(e=>e.setName("type").setDescription("Select mode").addChoices({name:"Permanent",value:"permanent"},{name:"Limited",value:"limited"}).setRequired(!0));async function ye(e){try{let t=await(0,z.parseMHWildsEvents)("https://info.monsterhunter.com/wilds/event-quest/en-us/schedule?utc=7"),n=e.options.getString("type",!0)||"all";if(t.eventQuests.length===0)return e.editReply("No events found.");let o=Ee(t.eventQuests,n),s=fe(o),i=j(s,ge);if(i.pages.length===0)return e.reply("No events found for the selected type.");let d=i.pages.length,a=0,p=i.attachmentsByPage[a],y={content:n==="permanent"?"Permanent Events":"Here are the ongoing events",embeds:i.pages[a].map(r=>r.embed),files:p,components:S(a,d,E)};await e.reply(y);let v=e.user?.id??null,c=null;try{c=await e.fetchReply()}catch(r){console.error("Failed to fetch reply for pagination:",r)}return d<=1||!c||typeof c.createMessageComponentCollector!="function"||Q(c,i,{commandUserId:v,timeoutMs:B,buttonIds:E}),c}catch(t){return console.error(t),e.editReply("Failed to fetch events.")}}var Ee=(e,t)=>{if(t==="all")return e;let n=t==="permanent";if(n)return e.filter(s=>s.isPermanent===n);let o=(0,C.default)();return e.filter(s=>(0,C.default)(s.startAt).isBefore(o)&&(0,C.default)(s.endAt).isAfter(o))};var N={};g(N,{data:()=>Ce,execute:()=>be});var Z=require("discord.js"),Ce=new Z.SlashCommandBuilder().setName("meta").setDescription("Return Meta Build Guide Reddit Link");async function be(e){return e.reply("Here is the link to the Meta Build Guide: https://www.reddit.com/r/MonsterHunterMeta/comments/1jkaxo7/mhwilds_endgame_meta_builds_compilation/")}var _={};g(_,{data:()=>ve,execute:()=>Re});var K=require("discord.js"),De=["Arkveld","Rey Dau","Nu Udra","Uth Duna","Jin Dahaad","Gore Magala","Mizutsune","Zho Shia"],ve=new K.SlashCommandBuilder().setName("hzv").setDescription("Return Meta Build Guide Reddit Link").addStringOption(e=>e.setName("monster").setDescription("Select monster").addChoices(...De.map(t=>({name:t,value:t}))).setRequired(!0));async function Re(e){let n=`./assets/hitzone-value/${e.options.getString("monster",!0).split(" ").join("_")}_HZV.png`;return e.reply({files:[n]})}var O={};g(O,{data:()=>Pe,execute:()=>Be});var b=require("discord.js"),M="https://genshin.hoyoverse.com/en/gift?code=";var Pe=new b.SlashCommandBuilder().setName("gi-code").setDescription("Return a redeem link for Genshin Impact, up to 3 codes").addStringOption(e=>e.setName("c1").setDescription("Enter the code").setRequired(!0)).addStringOption(e=>e.setName("c2").setDescription("Enter the code").setRequired(!1)).addStringOption(e=>e.setName("c3").setDescription("Enter the code").setRequired(!1));async function Be(e){console.log("gi-code invoked");let t=e.options.getString("c1",!0),n=e.options.getString("c2",!1),o=e.options.getString("c3",!1);if(console.log("parsing code with",t,n,o),!t)return e.editReply("No code provided.");let s=[];return t&&s.push(`${M}${t}`),n&&s.push(`${M}${n}`),o&&s.push(`${M}${o}`),console.log("returning message",s),e.reply({content:s.join(`
`),flags:b.MessageFlags.SuppressEmbeds})}var u={ping:P,meta:N,events:x,"gi-code":O,hzv:_};var D=require("discord.js");var Se=Object.values(u).map(e=>e.data),Te=new D.REST({version:"10"}).setToken(l.DISCORD_TOKEN);async function J(){try{console.log("Started refreshing application (/) commands."),await Te.put(D.Routes.applicationGuildCommands(l.DISCORD_CLIENT_ID,l.DISCORD_GUILD_ID),{body:Se}),console.log("Successfully reloaded application (/) commands.")}catch(e){console.error(e)}}function ee(e){console.log(`Received ${e}. Shutting down gracefully...`),I.destroy(),process.exit(0)}process.on("SIGTERM",()=>ee("SIGTERM"));process.on("SIGINT",()=>ee("SIGINT"));var I=new X.Client({intents:["Guilds","GuildMessages","DirectMessages"]}),we="0 10 * * 3";I.on("ready",async()=>{console.log("Discord bot is ready! \u{1F916}"),await J(),Y.default.schedule(we,async()=>{console.log("\u23F0 Running /events limited job...");try{let e=l.EVENTS_CHANNEL_ID.split(",");for(let t of e){let n=await I.channels.fetch(t);if(!n)return;let o={options:{getString:s=>s==="type"?"limited":null},reply:s=>n.send(s),editReply:s=>n.send(s)};await u.events.execute(o)}}catch(e){console.error("Failed scheduled job:",e)}},{timezone:"Asia/Bangkok"})});I.on("interactionCreate",async e=>{if(!e.isCommand())return;let{commandName:t}=e;u[t]&&u[t].execute(e)});I.login(l.DISCORD_TOKEN);
